# 为什么是 x·y = k？

> 💡 **核心问题**
> 
> 为什么Uniswap选择 x·y = k，而不是其他公式？
> 这个公式有什么特殊的优势？

---

## 📚 目录

1. [可能的公式选择](#1-可能的公式选择)
2. [为什么不用x+y=k](#2-为什么不用xyk)
3. [x·y=k的优势](#3-xyk的优势)
4. [数学性质](#4-数学性质)
5. [实际应用考虑](#5-实际应用考虑)

---

## 1. 可能的公式选择

### 1.1 候选公式

理论上，AMM可以使用任何公式来定价：

```
选项1: x + y = k      (恒定和)
选项2: x · y = k      (恒定乘积) ← Uniswap选择
选项3: x² + y² = k    (圆)
选项4: x^a · y^b = k  (加权)
...更多可能
```

让我们分析为什么选择了 `x · y = k`。

---

## 2. 为什么不用 x+y=k？

### 2.1 恒定和公式

```
x + y = k

例如：
x + y = 100

ETH  USDC
50 + 50 = 100
40 + 60 = 100
30 + 70 = 100
```

### 2.2 价格计算

对 `x + y = k` 求导：

```
dx/dx + dy/dx = 0
dy/dx = -1

价格 P = -dy/dx = 1（常数！）
```

**问题：价格永远是1！**

### 2.3 致命缺陷

假设初始：
- 50 ETH ($2000/个)
- 100,000 USDC

有人用1000 USDC买ETH：

```
根据 x + y = k：
ETH价格固定 = 1 USDC/ETH

能买 1000 ETH！

但池子里只有50个ETH！
```

**结果：流动性立即耗尽！❌**

### 2.4 可视化对比

```
y (USDC)
    ↑
100k│╲
    │ ╲ x+y=k (直线)
 50k│  ╲
    │   ╲_______ 流动性在x=0时耗尽
    └──────────→ x (ETH)
    0  50k  100k

y (USDC)
    ↑
    │     x·y=k (双曲线)
100k│    ╱
    │   ╱
 50k│  ╱
    │ ╱__________ 永不耗尽！
    └──────────→ x (ETH)
    0  50k  100k
```

---

## 3. x·y=k 的优势

### 3.1 永不耗尽

```
当 x → 0 时，y → ∞
当 y → 0 时，x → ∞

池子永远有流动性！
```

### 3.2 价格自动调节

```
买入ETH → x减少 → y/x上升 → 价格上涨
卖出ETH → x增加 → y/x下降 → 价格下跌

自动平衡供需！
```

### 3.3 计算简单

```
Gas费低：
- 只需乘法和除法
- 不需要复杂运算
- 链上计算友好
```

### 3.4 可预测性

```
任何人都可以计算：
- 当前价格
- 预期滑点
- 交易结果

完全透明！
```

---

## 4. 数学性质

### 4.1 双曲线特性

`y = k/x` 是标准双曲线：

#### 性质1：渐近线

```
x → 0, y → ∞  (垂直渐近线)
x → ∞, y → 0  (水平渐近线)
```

#### 性质2：凸函数

```
d²y/dx² = 2k/x³ > 0

曲线向下凸
→ 买越多，价格涨得越快
```

#### 性质3：对称性

```
如果交换x和y的角色：
结果完全对称

ETH/USDC 和 USDC/ETH 是镜像
```

### 4.2 弹性分析

#### 价格弹性

```
买入1%的ETH储备，价格上涨多少？

ε = (ΔP/P) / (Δx/x)

对于 x·y=k：
当 Δx 很小时，ε ≈ 1

线性关系！
```

---

## 5. 实际应用考虑

### 5.1 为什么Uniswap V1/V2选择它？

1. **简单**
   - 2017年AMM刚起步
   - 需要最简单可靠的公式
   - x·y=k 最容易理解和审计

2. **通用**
   - 适用于任何代币对
   - 不需要特殊参数
   - 部署成本低

3. **安全**
   - 经过数学验证
   - 不会出现异常情况
   - 风险可预测

### 5.2 为什么后来出现其他公式？

#### Curve的StableSwap

```
x·y=k 在稳定币交易中滑点太大

例如：USDC/USDT
1000 USDC → 999 USDT
滑点 = 0.1%（太高！）

Curve用混合曲线：
1000 USDC → 999.9 USDT
滑点 = 0.01%（完美！）
```

#### Balancer的加权池

```
x·y=k 要求50/50分配

如果你想：
80% ETH + 20% USDC
→ 降低无常损失

Balancer用：
x^0.8 · y^0.2 = k
```

#### Uniswap V3的集中流动性

```
x·y=k 流动性分散在所有价格

V3：只在价格区间提供流动性
→ 资金效率提升上千倍
```

### 5.3 总结

`x·y=k` 不是完美的，但它是：
- ✅ 最简单的
- ✅ 最通用的
- ✅ 最早被验证的
- ✅ 其他AMM的基础

**它是DeFi的"Hello World"！**

---

## 🧮 思考题

### 问题1

如果用 `x² + y² = k` (圆)会怎样？

<details>
<summary>点击查看答案</summary>

```
x² + y² = k 是一个圆

问题：
1. 价格 P = dy/dx = -x/y
   - 当x很大时，P → -∞
   - 负价格没有意义！

2. 流动性会耗尽
   - 在 x=√k 或 y=√k 时到达边界

3. 不对称
   - 买和卖的滑点不同

所以不适合做AMM！
```
</details>

### 问题2

为什么不直接用固定价格？

### 问题3

能否设计一个比x·y=k更好的公式？

---

## ✅ 学习检查清单

- [ ] 理解为什么x+y=k不行
- [ ] 知道x·y=k的4个优势
- [ ] 理解双曲线的数学性质
- [ ] 知道其他AMM公式的应用场景
- [ ] 能解释为什么Curve用不同公式

---

## 🎯 下一步

1. ✅ 学习其他AMM公式（Curve、Balancer）
2. ✅ 实际操作Uniswap
3. ✅ 对比不同DEX的滑点

---

**记住**：
- 📐 **x·y=k是最简单有效的AMM公式**
- 🎯 **不同场景需要不同公式**
- 💡 **理解数学才能理解DeFi**

继续深入学习！🚀
