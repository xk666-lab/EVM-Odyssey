# 第3步：源码实现 - GitHub代码精读

> 💡 **理解WHAT：具体如何实现**
> 
> 逐行理解代码，掌握实现细节

---

## 核心问题

在第3步，你需要回答：

```
1. 代码如何组织？
   → 文件结构是什么？

2. 每个函数做什么？
   → 核心逻辑是什么？

3. 为什么这样写？
   → 设计决策的原因？

4. 有什么优化技巧？
   → Gas如何节省？

5. 有什么安全机制？
   → 如何防止攻击？
```

---

## 源码阅读方法

### Level 1：整体结构（30分钟）

```
目标：了解项目组织

看什么：
✅ README.md
✅ 目录结构
✅ contracts/ 文件列表
✅ test/ 测试文件

问自己：
- 有哪些合约？
- 哪个是核心？
- 如何相互调用？
```

### Level 2：核心合约（2-3小时）

```
目标：理解核心逻辑

看什么：
✅ 核心合约的主要函数
✅ 状态变量
✅ 事件定义
✅ 修饰器

做什么：
- 逐行添加注释
- 画函数调用图
- 记录疑问
```

### Level 3：细节优化（2-3小时）

```
目标：理解优化技巧

看什么：
✅ Gas优化
✅ 安全检查
✅ 边界处理
✅ 错误处理

思考：
- 为什么用assembly？
- 为什么这样存储？
- 为什么这样检查？
```

---

## 以Uniswap V2为例

我们在"第3步-源码实现"中完成的：

```
✅ Pair核心源码（2,785行）
  ├─ swap/mint/burn逐行解析
  ├─ UQ112x112定点数详解
  ├─ EIP-2612 Permit机制
  └─ 10个接口与库详解

✅ Factory核心源码（1,952行）
  ├─ create2深度剖析
  ├─ Solidity版本对比
  └─ 18个Mermaid图表

✅ Router核心源码（2,090行）
  ├─ 8个swap函数详解
  ├─ 安全机制分析
  └─ 27个Mermaid图表
```

---

## 源码阅读技巧

### 技巧1：带着问题读

```
不要：逐行从头读到尾
要做：带着具体问题读

例如：
Q: swap函数如何防止重入？
→ 找到lock修饰器
→ 理解重入锁机制
→ 思考为什么有效

Q: 手续费如何收取？
→ 找到k值验证
→ 理解balanceAdjusted
→ 理解为什么"减去"手续费
```

### 技巧2：对比学习

```
对比V1和V2的代码差异：
→ 理解V2的改进点

对比标准ERC20和V2 ERC20：
→ 理解permit的实现

对比Uniswap和Curve：
→ 理解不同AMM算法
```

### 技巧3：画图理解

```
复杂逻辑用图表示：
✅ 函数调用图
✅ 状态转换图
✅ 数据流向图
✅ 序列图

Mermaid很好用！
```

---

## 源码精读输出

### 产出物清单

```
□ 带注释的源码
□ 函数调用关系图
□ 核心算法伪代码
□ Gas优化笔记
□ 安全机制总结
□ 疑问和解答
```

---

## ✅ 检查清单

- [ ] 理解每个核心函数的逻辑
- [ ] 能解释每个重要设计决策
- [ ] 识别所有Gas优化技巧
- [ ] 理解所有安全检查
- [ ] 能独立实现简化版
- [ ] 发现至少3个优化空间

---

**完成后** → [第4步：设计模式](./04-第4步：设计模式-提炼.md)
